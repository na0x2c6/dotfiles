#!/bin/bash

if [ -n "$TMUX" ]; then
  eval "$(tmux show-environment -s _HOST_EXEC_TARGET 2>/dev/null)" || true
fi

SOCAT_TARGET="${_HOST_EXEC_TARGET:-UNIX-CONNECT:/run/user/${UID}/host-exec.sock}"

if [ $# -eq 0 ]; then
    socat - "$SOCAT_TARGET"
else
    if [ -t 0 ]; then
        echo "$*" | socat - "$SOCAT_TARGET"
    else
        {
            echo "$*"
            cat
        } | socat - "$SOCAT_TARGET"
    fi
fi
