#!/bin/bash

SOCKET="/run/user/${UID}/host-exec.sock"

NO_NEWLINE=false
LIST_TYPES=false
WATCH_CMD=()

while [[ $# -gt 0 ]]; do
    case "$1" in
        -n|--no-newline)
            NO_NEWLINE=true
            shift
            ;;
        -l|--list-types)
            LIST_TYPES=true
            shift
            ;;
        -w|--watch)
            shift
            WATCH_CMD=("$@")
            break
            ;;
        -p|--primary|-s|--seat|-t|--type)
            # ignore
            case "$1" in
                -s|--seat|-t|--type) shift 2 ;;
                *) shift ;;
            esac
            ;;
        -h|--help|-v|--version)
            shift
            ;;
        --)
            shift
            break
            ;;
        -*)
            shift
            ;;
        *)
            break
            ;;
    esac
done

if $LIST_TYPES; then
    # pbpaste is not supported MIME Type
    echo "text/plain"
    exit 0
fi

if [[ ${#WATCH_CMD[@]} -gt 0 ]]; then
    echo "wl-paste: --watch is not supported in this wrapper" >&2
    exit 1
fi

OUTPUT=$(echo "pbpaste" | socat - UNIX-CONNECT:"$SOCKET")

if $NO_NEWLINE; then
    printf '%s' "$OUTPUT"
else
    printf '%s\n' "$OUTPUT"
fi
