#!/bin/bash

if [ -z "$HOST_OS" ]; then
  HOST_OS="$(_exec-host uname -s 2>/dev/null < /dev/null | tr '[:upper:]' '[:lower:]')"
  export HOST_OS
fi

if [[ "$HOST_OS" == "linux" ]]; then
    _exec-host wl-copy "$@"
    exit $?
fi

### for macOS
CLEAR=false
TRIM_NEWLINE=false

while [[ $# -gt 0 ]]; do
    case "$1" in
        -c|--clear)
            CLEAR=true
            shift
            ;;
        -n|--trim-newline)
            TRIM_NEWLINE=true
            shift
            ;;
        -p|--primary|-o|--once|-f|--foreground)
            shift
            ;;
        -t|--type|-s|--seat)
            shift 2
            ;;
        -h|--help|-v|--version)
            shift
            ;;
        --)
            shift
            break
            ;;
        -*)
            shift
            ;;
        *)
            break
            ;;
    esac
done

if $CLEAR; then
    echo -n | _exec-host pbcopy
    exit 0
fi

if [[ $# -gt 0 ]]; then
    if $TRIM_NEWLINE; then
        printf '%s' "$*" | _exec-host pbcopy
    else
        echo "$*" | _exec-host pbcopy
    fi
else
    if $TRIM_NEWLINE; then
        INPUT=$(cat)
        printf '%s' "${INPUT%$'\n'}" | _exec-host pbcopy
    else
        _exec-host pbcopy
    fi
fi
